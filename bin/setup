#! /bin/sh

set -eu

version='1.3.1'

binary_dir=$(cd $(dirname $0) && pwd)

case "$(uname)" in
  "Darwin")
    mitamae_bin="mitamae-x86_64-darwin"
    ;;
  "Linux")
    mitamae_bin="mitamae-x86_64-linux"
    ;;
  *)
    echo "unknown uname: $(uname)"
    exit 1
    ;;
esac

mitamae_gz="${mitamae_bin}.tar.gz"
mitamae_invoke="${mitamae_bin}-${version}-invoke"

curl -o "${binary_dir}/${mitamae_gz}" -fL "https://github.com/k0kubun/mitamae/releases/download/v${version}/${mitamae_bin}.tar.gz"
tar xvzf "${binary_dir}/${mitamae_gz}"
rm "${binary_dir}/${mitamae_gz}"
mv "${mitamae_bin}" "${binary_dir}/${mitamae_invoke}"
chmod +x "${binary_dir}/${mitamae_invoke}"
ln -sf "${binary_dir}/${mitamae_invoke}" "${binary_dir}/mitamae"
